<div class="text-white px-4 pb-8 max-w-[1600px] mx-auto pt-4">
    
  <div class="flex justify-between items-center mb-6 border-b border-gray-700 pb-4">
    <div>
      <h2 class="text-3xl font-bold text-yellow-400">Exam Marks Management</h2>
      <p class="text-gray-400 text-sm mt-1">
        Results for: <span class="text-white font-semibold" *ngIf="exam">{{ exam?.title }}</span>
      </p>
    </div>
    <button 
      (click)="close.emit()" 
      class="bg-gray-700 hover:bg-gray-600 text-white px-5 py-2 rounded-lg text-sm font-medium transition shadow-lg flex items-center gap-2">
      <span>â¬…</span> Back
    </button>
  </div>

  <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">

    <div class="lg:col-span-1">
      <div class="bg-gray-800 p-6 rounded-xl border border-gray-700 shadow-lg sticky top-6">
        <h3 class="text-xl font-semibold text-white mb-4 border-b border-gray-600 pb-2">Exam Info</h3>
        
        <div *ngIf="exam" class="space-y-4">
          <div>
            <label class="text-xs text-gray-400 uppercase font-bold">Exam Title</label>
            <p class="text-yellow-400 font-medium text-lg">{{ exam.title }}</p>
          </div>
          
          <div class="pt-4 mt-4 border-t border-gray-700">
            <div class="flex items-center gap-2">
               <span class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></span>
               <span class="text-sm text-gray-300">Live Results</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="lg:col-span-3">
      <div class="bg-gray-800 rounded-xl border border-gray-700 shadow-lg overflow-hidden min-h-[400px]">
        
        <div class="bg-gray-900/50 p-4 border-b border-gray-700 flex justify-between items-center">
          <div class="flex items-center gap-3">
            <h3 class="font-semibold text-white">Student List</h3>
            <span *ngIf="loadingUsers" class="text-xs text-yellow-400 bg-yellow-900/20 px-2 py-1 rounded border border-yellow-800 animate-pulse">
               Loading Names...
            </span>
          </div>
          <span class="text-sm text-gray-400" *ngIf="!loading()">
            Total: {{ marksList().length }} Students
          </span>
        </div>

        <div *ngIf="loading()" class="flex flex-col items-center justify-center h-64">
          <div class="animate-spin rounded-full h-10 w-10 border-b-2 border-yellow-400 mb-4"></div>
          <p class="text-gray-400">Fetching results...</p>
        </div>

        <div *ngIf="!loading() && !error()" class="overflow-x-auto">
          <table class="w-full text-left border-collapse">
            <thead class="bg-gray-700/50 text-gray-300 text-sm uppercase">
              <tr>
                <th class="p-4 font-medium">Student Name</th>
                <th class="p-4 font-medium text-center">Score</th>
                <th class="p-4 font-medium text-center">Result</th>
                <th class="p-4 font-medium text-right">Action</th>
              </tr>
            </thead>
            <tbody class="divide-y divide-gray-700">
              
              <tr *ngIf="marksList().length === 0">
                <td colspan="4" class="p-10 text-center text-gray-500">No records found.</td>
              </tr>

              <tr *ngFor="let mark of marksList()" class="hover:bg-gray-700/30 transition">
                
                <td class="p-4">
                  <div class="flex items-center gap-3">
                    <div class="w-9 h-9 rounded-full bg-blue-900/50 flex items-center justify-center text-sm font-bold text-blue-200 border border-blue-800 shadow-sm">
                      {{ (studentData[mark.studentId]?.displayName | slice:0:1) || '?' }}
                    </div>
                    
                    <div class="text-white font-medium text-base">
                      {{ studentData[mark.studentId]?.displayName || 'Loading Student...' }}
                    </div>
                  </div>
                </td>
                
                <td class="p-4 text-center">
                  <span [ngClass]="mark.marks !== null && mark.marks >= 50 ? 'text-green-400 font-bold' : 'text-red-400 font-bold'">
                    {{ mark.marks !== null ? mark.marks : '-' }}
                  </span>
                </td>

                <td class="p-4 text-center">
                   <span class="px-3 py-1 rounded-full text-xs font-semibold tracking-wide"
                    [ngClass]="{
                      'bg-green-900/30 text-green-400 border border-green-800': mark.examStatus === 'Passed' || mark.examStatus === 'Completed',
                      'bg-red-900/30 text-red-400 border border-red-800': mark.examStatus === 'Failed',
                      'bg-gray-700 text-gray-400': !mark.examStatus || (mark.examStatus !== 'Passed' && mark.examStatus !== 'Completed' && mark.examStatus !== 'Failed')
                    }">
                    {{ mark.examStatus || 'Pending' }}
                  </span>
                </td>

                <td class="p-4 text-right">
                  <button (click)="editMark(mark.studentId)" class="text-blue-400 hover:text-white hover:bg-blue-600 px-4 py-1.5 rounded transition text-sm font-medium">
                    Edit Result
                  </button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>

      </div>
    </div>
  </div>
</div>